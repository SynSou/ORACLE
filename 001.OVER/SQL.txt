SELECT
DISTINCT 
TD_STOCK.LOC
,CASE WHEN TD_STOCK.HIKI_KANO_SU_BARA >0 OR TD_STOCK.HIKI_SU_BARA >0 THEN 1 ELSE 0 END AS CLS
,COUNT(DISTINCT TD_STOCK.ITM_CD) OVER (PARTITION BY TD_STOCK.LOC,CASE WHEN TD_STOCK.HIKI_KANO_SU_BARA >0 OR TD_STOCK.HIKI_SU_BARA >0 THEN 1 ELSE 0 END)  AS LOC_CNT
,COUNT(DISTINCT TD_STOCK.ITM_CD) OVER (PARTITION BY TD_STOCK.LOC) AS LOC_TOTAL
,COUNT(DISTINCT TD_STOCK.ITM_CD) OVER (PARTITION BY CASE WHEN TD_STOCK.HIKI_KANO_SU_BARA >0 OR TD_STOCK.HIKI_SU_BARA >0 THEN 1 ELSE 0 END) AS CLS_TOTAL
,COUNT(DISTINCT TD_STOCK.ITM_CD) OVER (PARTITION BY 1) AS TOTAL
FROM TD_STOCK 
WHERE TD_STOCK.LOC IN ('DIFF_LOCA','DIFF_LOCH')

